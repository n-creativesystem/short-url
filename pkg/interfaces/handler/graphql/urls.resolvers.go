package graphql

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.33

import (
	"context"
	"net/url"

	"github.com/n-creativesystem/short-url/pkg/interfaces/handler/graphql/models"
)

// GenerateURL is the resolver for the generateURL field.
func (r *mutationResolver) GenerateURL(ctx context.Context, input models.CreateURLInput) (*models.URL, error) {
	user, err := authorize(ctx)
	if err != nil {
		return nil, err
	}
	result, err := r.shortUrlSvc.GenerateShortURL(ctx, input.URL.String(), "", user)
	if err != nil {
		return nil, err
	}
	v := models.ShortModelToURL(*result)
	return &v, nil
}

// UpdateURL is the resolver for the updateURL field.
func (r *mutationResolver) UpdateURL(ctx context.Context, key string, url url.URL) (*models.URL, error) {
	user, err := authorize(ctx)
	if err != nil {
		return nil, err
	}
	result, err := r.shortUrlSvc.Update(ctx, key, user, url.String())
	if err != nil {
		return nil, err
	}
	v := models.ShortModelToURL(*result)
	return &v, nil
}

// DeleteURL is the resolver for the deleteURL field.
func (r *mutationResolver) DeleteURL(ctx context.Context, key string) (bool, error) {
	user, err := authorize(ctx)
	if err != nil {
		return false, err
	}
	if err := r.shortUrlSvc.Remove(ctx, key, user); err != nil {
		return false, err
	}
	return true, nil
}

// Urls is the resolver for the urls field.
func (r *queryResolver) Urls(ctx context.Context) (*models.URLType, error) {
	user, err := authorize(ctx)
	if err != nil {
		return nil, err
	}
	urls, err := r.shortUrlSvc.FindAll(ctx, user)
	if err != nil {
		return nil, err
	}
	result := make([]*models.URL, 0, len(urls))
	for _, u := range urls {
		typ := models.ShortModelToURL(u)
		result = append(result, &typ)
	}
	return &models.URLType{
		Result: result,
	}, nil
}

// URL is the resolver for the url field.
func (r *queryResolver) URL(ctx context.Context, key string) (*models.URL, error) {
	user, err := authorize(ctx)
	if err != nil {
		return nil, err
	}
	v, err := r.shortUrlSvc.FindByKeyAndAuthor(ctx, key, user)
	if err != nil {
		return nil, err
	}
	u := models.ShortModelToURL(*v)
	return &u, nil
}
